# 如何将旧电脑系统完整克隆到新电脑：Windows 系统迁移全攻略

Windows官方没有提供迁移到新设备的方法。每次更换电脑，都需要在新的系统里，将旧设备里的东西一点点搬过来，非常繁琐不说，还容易遗漏。

这里介绍一种快捷的方法，可以将原有系统和数据完整放到新设备里。绝大部分情况下都是可行的，例外情况需要注意：新设备硬件架构不兼容旧设备的系统（例如采用ARM CPU的电脑不能将原设备是x86(_64)的电脑的系统搬过来），新设备的硬盘容量小于旧设备的硬盘容量（可以将旧设备的硬盘数据靠前放置来规避）。

## 执行步骤

1. 整机备份，整机还原。

   群晖(Synology)提供了工具Active Backup for Business，在旧设备上安装并执行完整备份。

   在新设备上使用Active Backup for Business Recovery Media将备份恢复到新设备硬盘上。

   有可能发生找不到新设备硬盘的情况，通常可以从设备官网下载相应的硬盘控制器驱动，并加载来解决。

   也可以使用类似Linux dd这样的工具，以离线方式1:1复制。这是最干净的做法，但也有更高技术要求。

   当然，也可以将旧设备的硬盘拔下来，放到新设备的硬盘上。但是不建议这么做，可能因为意外，永久丢失数据。

2. 为新设备的系统添加驱动。

   在完成前面的步骤1之后，新设备开机，可能会启动失败。通常，这是因为当前系统缺少新设备的关键驱动，主要是硬盘控制器驱动。

   准备一个Windows PE盘（或者用Windows Go，或者将新硬盘取出来外挂），若Windows PE看不到新设备硬盘，则可以通过drvload加载相应的硬盘控制器驱动。

   假设新设备的Windows系统挂载的盘符是C，新设备驱动(包括硬盘控制器驱动)放在U盘里，路径是D:\drivers。执行以下命令，将驱动植入新设备的Windows系统里。

   ```cmd
   DISM /Image:C:\ /Add-Driver /driver:D:\drivers\ /recurse
   ```

3. 切换安全模式

   虽然步骤2已经将硬盘控制器驱动放到Windows系统里，但是具体的硬件设备并未安装相应的驱动，所以Windows启动依然会失败。

   可以将Windows启动方式改为安全模式，以便Windows能够自动处理设备变更和安装驱动。

   依然使用Windows PE，完成后续操作。

   如果系统使用 UEFI 引导，BCD 文件通常在 EFI 分区：

   EFI 分区通常是 100MB–500MB FAT32 分区，需要挂载后访问。例如挂载为 Z:

   用 diskpart 挂载 EFI 分区

   找到 EFI 分区

   ```cmd
   diskpart
   list disk
   select disk 0
   ```

   选择 EFI 分区

   ```cmd
   list partition
   select partition X
   assign letter=Z
   exit
   ```

   ```cmd
   bcdedit /store Z:\EFI\Microsoft\Boot\BCD /set {default} safeboot minimal
   ```

4. 进入系统，退出安全模式

   经过上述步骤后，重启新设备应该就可以进入系统了。
   
   有可能，会在正在准备设备很久。不用担心，强制关机后，再开机就可以进入系统了。

   进入系统后，可以使用msconfig工具，修改引导选项，关闭安全引导。

   再重启，就可以正常使用新设备了，后面就是安装新设备的驱动等收尾工作。
   
   所有的东西都在，完全免去迁移的烦恼。当然，如果之前系统存在的（软件）问题，也会保留。